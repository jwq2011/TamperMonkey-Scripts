
# 🚀 Jira Activity Module Fullscreen Toggle — 油猴脚本

> 为 Jira 的「活动日志」模块添加一键全屏/退出全屏功能，提升阅读与操作体验。

---

## 📄 目录

- [功能描述](#功能描述)
- [设计思路](#设计思路)
- [安装与使用](#安装与使用)
- [完整AI输入词（供后续修改/扩展使用）](#完整ai输入词供后续修改扩展使用)
- [油猴脚本（Tampermonkey）简介](#油猴脚本tampermonkey简介)
- [常见问题](#常见问题)
- [更新日志](#更新日志)
- [贡献与反馈](#贡献与反馈)

---

## ✅ 功能描述

本脚本在 Jira 问题页面的「活动日志（Activity Log）」模块标题右侧**动态添加一个切换按钮**：

- **默认不自动开启全屏** — 页面加载后保持原布局，不干扰用户。
- **点击「全屏模式」** → 活动日志模块全屏展开，隐藏侧边栏和其他模块，专注查看日志。
- **点击「退出全屏」** → 恢复原始布局，所有隐藏元素重新显示。
- **防重复执行机制** — 避免重复添加按钮或样式冲突。
- **兼容性强** — 适配 Jira 页面结构，使用安全的 DOM 查询和样式控制。
- **轻量无依赖** — 无外部库，纯原生 JS，性能开销极小。
- ✅ **一键全屏切换**：点击按钮进入/退出全屏，专注查看活动日志。
- ✅ **悬浮退出按钮**：全屏时右上角固定显示“退出全屏”按钮。
- ✅ **AI 分析能力**：点击“AI 分析”按钮，自动提取 `.mod-content` 内容并提交至阿里百炼大模型分析。
- ✅ **模型配置支持**：可手动设置 API Key 和模型名称（如 `qwen-plus`）。

适用场景：
- 查看长篇评论或大量活动记录时
- 需要专注阅读变更历史、评论内容
- 在会议或演示中突出显示活动日志

---

## 💡 设计思路

1. **精准定位**
   通过 `#activitymodule` 和 `#activitymodule_heading` 精准定位活动日志模块及标题栏，避免误操作其他模块。

2. **动态插入按钮**
   在标题栏末尾创建按钮，样式采用现代 UI 设计（圆角、阴影、悬停过渡），与 Jira 原生风格协调。

3. **非侵入式控制**
   - 不修改 Jira 原有功能逻辑
   - 使用 `dataset` 标记被隐藏元素，确保恢复时精准还原
   - 使用 `!important` 确保全屏样式优先，避免被 Jira 样式覆盖

4. **稳定性增强**
   - 添加 `window.activityFullscreenScriptLoaded` 全局锁，防止 Tampermonkey 多次注入
   - 设置 3 秒后重试机制，应对 Jira 动态加载延迟
   - 所有 DOM 操作前检查元素是否存在，避免报错

5. **用户体验优化**
   - 按钮文字与颜色随状态切换（蓝→红）
   - 控制台输出日志，便于调试
   - 平滑过渡动画提升交互体验

---

## ⚙️ 安装与使用

### 安装步骤：

1. 安装 [Tampermonkey](https://www.tampermonkey.net/) 浏览器扩展（Chrome / Edge / Firefox 均支持）
2. 点击 Tampermonkey 图标 → “创建新脚本”
3. 删除默认内容，粘贴本脚本代码 → 保存（Ctrl+S）
4. 刷新 Jira 问题页面（如 `https://jira-sh.xxxxauto.com:8080/browse/XXX-123`）
5. 在“活动日志”标题右侧查看按钮 → 点击即可切换全屏

> ✅ 脚本仅在匹配 URL `*://jira-sh.xxxxauto.com:8080/*` 时运行，不影响其他网站。

### 使用提示：

- 如果按钮未出现，请等待 3~5 秒或手动刷新页面
- 如遇样式异常，可多次点击按钮重置状态
- 支持在多个 Jira 问题页面间跳转，脚本会自动重新绑定

---

## 🧠 完整AI输入词（供后续修改/扩展使用）

> 请复制以下整段内容，下次直接粘贴给 AI，即可快速生成修改或新增功能的脚本：

---

我有一个油猴脚本，功能是为 Jira 的活动日志模块添加全屏切换按钮。当前功能包括：

1. 在 `#activitymodule_heading` 内创建一个按钮，默认文字“全屏模式”，点击后：
   - 将活动模块设为全屏（`position: fixed; top: 70px; width: 100%; height: calc(100% - 70px);`）
   - 隐藏侧边栏 `.aui-sidebar`
   - 隐藏 `.issue-body-content` 内除活动模块和 `#stalker`（固定顶栏）外的所有 `.module`
   - 按钮文字变为“退出全屏”，颜色变红
2. 再次点击恢复原状，显示所有隐藏元素，按钮恢复蓝色
3. 有防重复执行机制（`window.activityFullscreenScriptLoaded`）
4. 3秒后重试创建按钮
5. 使用原生 JS，无依赖

请基于当前版本帮我修改或新增以下功能：
- [在此描述你的新需求，例如：增加快捷键 Esc 退出全屏 / 支持记住上次状态 / 增加动画过渡 / 支持深色模式 / 添加配置面板等]

要求：
- 保持代码简洁稳定
- 不破坏现有功能
- 输出完整可运行的油猴脚本
- 使用 Markdown 格式回复，包含更新说明

---

> ✅ 你只需替换 `[在此描述你的新需求]` 部分，即可快速获得定制化升级脚本！

---

## 🐒 油猴脚本（Tampermonkey）简介

### 什么是 Tampermonkey？

Tampermonkey 是一款浏览器扩展（支持 Chrome、Edge、Firefox、Safari 等），允许用户在网页上运行自定义的 JavaScript 脚本，从而：

- 修改页面样式或布局
- 自动填写表单
- 增强功能或添加按钮
- 屏蔽广告或无用元素
- 批量操作或数据导出

它被称为“浏览器的瑞士军刀”，是前端自动化和网页增强的强大工具。

### 为什么使用油猴脚本？

- ✅ **用户侧控制**：不依赖网站提供功能，自己定制体验
- ✅ **轻量无痕**：无需安装应用，不上传数据，本地执行
- ✅ **社区丰富**：全球有数万个现成脚本解决各种需求
- ✅ **开发简单**：懂点 JS 就能写，调试方便

### 安装 Tampermonkey

1. 访问官网：👉 [https://www.tampermonkey.net/](https://www.tampermonkey.net/)
2. 根据你的浏览器下载安装扩展
3. 安装后浏览器右上角会出现猴子图标 🐒
4. 点击图标 → “创建新脚本” → 粘贴代码 → 保存 → 完成！

---

## ❓ 常见问题

### Q1：按钮没出现怎么办？

- 等待几秒，Jira 可能还在加载
- 检查 URL 是否匹配（当前脚本只在 `jira-sh.xxxxauto.com:8080` 下运行）
- 打开控制台（F12）查看是否有报错
- 尝试手动刷新页面

### Q2：全屏后页面错乱？

- 多半是 Jira 页面结构有变动，可尝试点击按钮几次重置
- 或联系作者更新选择器

### Q3：能否支持其他 Jira 实例？

可以！只需修改 `@match` 行：
```js
// @match        *://your-jira-domain.com/*
```

### Q4：能否记住上次全屏状态？

可以，后续版本可加入 `localStorage` 记忆功能 —— 请使用上方“完整AI输入词”提出此需求，我将为你升级。

---

## 🧠 AI 分析功能说明
点击“AI 分析”按钮，脚本将提取 `.mod-content` 内容并提交至阿里百炼大模型进行分析。
分析结果将以以下方式展示：
- ✅ 弹窗展示（支持 Markdown 渲染）
- ✅ 可拖拽、可缩放
- ✅ “复制结果”按钮
- ✅ “新窗口打开”按钮（支持完整 Markdown 渲染）

## 📝 更新日志

### v2.0.0（当前版本）
- ✅ 集成 `marked.js` 实现 Markdown 渲染
- ✅ 新增“复制”和“新窗口打开”按钮
- ✅ 支持弹窗拖拽与缩放
- ✅ 优化弹窗 UI 与交互体验

### v1.0

- ✅ 彻底修复按钮重复创建问题
- ✅ 修复全屏后页面内容消失问题
- ✅ 增加防重复执行全局锁
- ✅ 优化样式优先级和恢复逻辑
- ✅ 增加重试机制提升稳定性
- ✅ 简化代码结构，提高可维护性

---

## ⚙️ 配置说明
点击“配置”按钮，填写以下信息：
- **API Key**：从阿里百炼平台获取的 DashScope API Key。
- **模型名称**：支持选择预设模型（如 `qwen-plus`、`qwen-max`），也可手动输入自定义模型。
⚠️ 注意：阿里百炼平台暂不支持模型列表自动获取，建议访问 [DashScope 控制台](https://dashscope.console.aliyun.com/) 查看可用模型。

## 🤝 贡献与反馈

欢迎提出功能建议、报告 Bug 或贡献代码！

- 🐞 报告问题：请提供控制台错误截图 + Jira 页面 URL
- 💡 功能建议：使用“完整AI输入词”格式描述你的需求
- 📬 联系作者：通过 GitHub Issue 或评论区留言

---

> © 2025 Jira Power User Tools — 让你的 Jira 体验更高效、更舒适 ❤️


---

✅ 此 Readme.md 已包含：

- 清晰的功能说明与设计哲学
- **可复用的 AI 输入词模板**（核心需求，便于你后续自助升级）
- 油猴脚本科普（方便不熟悉的人理解）
- 安装使用指南与常见问题
- 更新日志与贡献方式

你可以直接保存为 `README.md` 文件，或粘贴到项目仓库、笔记工具中。下次想升级功能时，直接复制“完整AI输入词”部分，填入你的新需求，交给 AI 即可获得升级版脚本！
